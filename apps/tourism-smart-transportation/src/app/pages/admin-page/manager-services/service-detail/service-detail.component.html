<tourism-smart-transportation-loading-progress
  *ngIf="loading"
></tourism-smart-transportation-loading-progress>
<div class="tier-details">
  <div class="header-tier-content">
    <div class="header-content-item">
      <div class="header-item-H5">Gói dịch vụ</div>
      <div class="header-item">|</div>
      <div class="header-item-H6">Tạo mới gói dịch vụ</div>
    </div>
    <div class="right-btn-form">
      <button
        [style]="{ width: '57', height: '32px' }"
        class="p-button-outlined p-button-rounded"
        pButton
        pRipple
        type="button"
        label="Chỉnh sửa"
        (click)="onChangeEdit()"
        *ngIf="editBtnStatus"
        [ngClass]="editModeStatus ? 'hidden' : ''"
      ></button>
      <button
        [style]="{ width: '57', height: '32px' }"
        class="p-button-outlined p-button-rounded"
        pButton
        pRipple
        type="button"
        label="Hủy"
        *ngIf="editModeStatus && editBtnStatus"
        (click)="onCancleEdit()"
      ></button>
      <button
        [style]="{ width: '57', height: '32px' }"
        class="p-button-rounded button-rounded button-background"
        pButton
        pRipple
        type="button"
        label="Lưu"
        *ngIf="editModeStatus && editBtnStatus"
        (click)="onUpdate()"
      ></button>
      <button
        [style]="{ width: '57', height: '32px' }"
        class="p-button-outlined p-button-rounded"
        pButton
        pRipple
        type="button"
        label="Quay lại"
        *ngIf="createStatus"
        (click)="onCancle()"
      ></button>
      <button
        [style]="{ width: '57', height: '32px' }"
        class="p-button-rounded button-rounded button-background"
        pButton
        pRipple
        type="button"
        label="Lưu"
        *ngIf="createStatus"
        (click)="onSave()"
      ></button>
    </div>
  </div>
  <p-divider></p-divider>
  <form [formGroup]="tierForm">
    <div class="form-edit">
      <div class="form-edit-container">
        <div class="upload-container">
          <label for="upload" class="thumnail">
            <img [src]="imagePreview" />
            <span class="thumnail-text">Tải hình ảnh lên</span>
            <div class="icon-overplay">
              <div class="circle-icon">
                <span class="material-icons-outlined"> photo_camera </span>
              </div>
            </div>
            <div class="image-overlay"></div>
          </label>
          <input
            type="file"
            id="upload"
            accept="image/*"
            (input)="onUpload($event)"
          />
        </div>
        <div class="grid p-fluid form-content">
          <div class="col-12 tier-input-long">
            <div class="tier-text">
              Tên gói
              <small
                *ngIf="
              _tiersForm['tierName'].errors?.['required'] && isSubmit
          "
                class="p-error"
              >
                không được bỏ trống
              </small>
            </div>
            <input
              class="tier-input-text-long"
              type="text"
              pInputText
              formControlName="tierName"
            />
          </div>
          <div class="col-12 tier-input-long">
            <div class="tier-text">
              Mô tả
              <small
                *ngIf="
              _tiersForm['description'].errors?.['required']  && isSubmit
          "
                class="p-error"
              >
                không được bỏ trống
              </small>
            </div>
            <input
              class="tier-input-text-long"
              type="text"
              pInputText
              formControlName="description"
            />
          </div>
          <div class="col-12 tier-input-long">
            <div class="tier-text">
              Giá
              <small
                *ngIf="
              _tiersForm['price'].errors?.['required']  && isSubmit
          "
                class="p-error"
              >
                không được bỏ trống
              </small>
            </div>
            <p-inputNumber
              class="tier-input-text-long"
              type="text"
              mode="currency"
              currency="VND"
              locale="vi-VN"
              formControlName="price"
            ></p-inputNumber>
          </div>
          <div class="col-12 tier-input-long">
            <div class="tier-text">
              Tiêu đề quảng cáo
              <small
                *ngIf="
              _tiersForm['promotedTitle'].errors?.['required']  && isSubmit
          "
                class="p-error"
              >
                không được bỏ trống
              </small>
            </div>
            <input
              class="tier-input-text-long"
              type="text"
              pInputText
              formControlName="promotedTitle"
            />
          </div>
        </div>
      </div>
    </div>
    <p-divider class="bottom-divider"></p-divider>
    <div class="footer-service-tier">
      <div class="body-table">
        <table>
          <tr class="body-table-header">
            <th>Tên</th>
            <th>Loại dịch vụ</th>
            <th>Giới hạn</th>
            <th>Giá trị</th>
            <th>Hành động</th>
          </tr>

          <div style="height: 15px" class="divider-table"></div>
          <ng-container formArrayName="packages">
            <ng-container
              *ngFor="let package of _packagesForm.controls; let i = index"
              [formGroupName]="i"
            >
              <tr class="body-table-data">
                <td>
                  <div class="tier-input-long">
                    <input
                      class="tier-input-text-long"
                      type="text"
                      pInputText
                      formControlName="packageName"
                    /><small
                      *ngIf="
                      _packagesForm.controls[i].get('packageName')?.errors?.['required']  && isSubmit
                      "
                      class="p-error"
                    >
                      không được bỏ trống
                    </small>
                  </div>
                </td>
                <td>
                  <div class="tier-input-long">
                    <p-dropdown
                      class="dropdown"
                      [style]="{ width: '95%', height: '28px' }"
                      [options]="serviceTypes"
                      formControlName="serviceType"
                      optionLabel="name"
                      optionValue="id"
                      placeholder="Chọn một dịch vụ"
                      (onChange)="onChangeServiceType()"
                    ></p-dropdown>
                    <small
                      *ngIf="
                      _packagesForm.controls[i].get('serviceType')?.errors?.['required']  && isSubmit
                      "
                      class="p-error"
                    >
                      không được bỏ trống
                    </small>
                  </div>
                </td>
                <td>
                  <div class="tier-input-long">
                    <div class="input-suffix">
                      <p-inputNumber
                        class="tier-input-text-long"
                        formControlName="limit"
                      ></p-inputNumber>
                      <span>{{
                        _packagesForm.controls[i].get('serviceType')?.value ===
                        'd3d43e77-1602-4e16-a8d7-485d4f309db7'
                          ? 'Km'
                          : 'Lần'
                      }}</span>
                    </div>
                    <small
                      *ngIf="
                      _packagesForm.controls[i].get('limit')?.errors?.['required']  && isSubmit
                      "
                      class="p-error"
                    >
                      không được bỏ trống
                    </small>
                  </div>
                </td>
                <td>
                  <div class="tier-input-long">
                    <div class="input-suffix">
                      <p-inputNumber
                        class="tier-input-text-long"
                        formControlName="value"
                      >
                      </p-inputNumber>
                      <span>{{
                        _packagesForm.controls[i].get('serviceType')?.value ===
                        'd3d43e77-1602-4e16-a8d7-485d4f309db7'
                          ? 'Lần'
                          : '%'
                      }}</span>
                    </div>
                    <small
                      *ngIf="
                      _packagesForm.controls[i].get('value')?.errors?.['required']  && isSubmit
                      "
                      class="p-error"
                    >
                      không được bỏ trống
                    </small>
                  </div>
                </td>

                <td
                  (click)="onClickDeleteItem(i)"
                  style="
                    text-align: center;
                    padding-bottom: 20px;
                    cursor: pointer;
                  "
                >
                  <span class="material-icons-outlined"> delete </span>
                </td>
              </tr>
            </ng-container>
          </ng-container>
        </table>
        <div class="footer-table" *ngIf="createStatus">
          <button
            [style]="{ width: '57', height: '32px' }"
            class="p-button-outlined p-button-rounded btn-create"
            pButton
            pRipple
            type="button"
            (click)="addNewPackgeForm()"
          >
            Tạo mới <span class="material-icons"> add </span>
          </button>
        </div>
        <div class="footer-table" *ngIf="editModeStatus">
          <button
            [style]="{ width: '57', height: '32px' }"
            class="p-button-outlined p-button-rounded btn-create"
            pButton
            pRipple
            type="button"
            (click)="addNewPackgeForm()"
          >
            Tạo mới <span class="material-icons"> add </span>
          </button>
        </div>
      </div>
    </div>
  </form>
</div>
<p-confirmDialog #cd [style]="{ width: '450px', height: '101px' }">
  <ng-template pTemplate="header">
    <div class="confirm-dialog-subtitle">Bạn có chắc chắn muốn thoát?</div>
  </ng-template>
  <ng-template pTemplate="footer">
    <button
      [style]="{ width: '57', height: '32px' }"
      class="p-button-outlined p-button-rounded"
      pButton
      pRipple
      type="button"
      label="Đóng"
      (click)="cd.reject()"
    ></button>
    <button
      [style]="{ width: '57', height: '32px' }"
      class="p-button-outlined p-button-rounded"
      pButton
      pRipple
      type="button"
      label="Hủy Thay Đổi"
      (click)="cancleDialog()"
    ></button>
    <button
      [style]="{ width: '57', height: '32px' }"
      class="p-button-rounded button-rounded"
      pButton
      pRipple
      type="button"
      label="Lưu Thay Đổi"
      (click)="cd.accept()"
    ></button>
  </ng-template>
</p-confirmDialog>
<p-toast position="top-right"></p-toast>
